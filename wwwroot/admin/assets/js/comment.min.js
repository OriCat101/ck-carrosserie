var commentManager={reload:!1,loadSearch:function(e){var t="muraAction=cComments.loadComments&siteid="+siteid+"&"+e+"&cacheid="+Math.random();commentManager.reload=!1,$("#commentSearch").html('<div class="load-inline"></div>'),$("#commentSearch .load-inline").spin(spinnerArgs2),$.get("./?"+t,function(e){$("#commentSearch").html(e),setDatePickers(".mura-custom-datepicker",dtLocale,dtCh),setCheckboxTrees(),$("#advancedSearch").find("ul.categories:not(.checkboxTrees)").css("margin-left","10px"),commentManager.bindEvents()})},bulkEdit:function(){var e=$("#frmUpdate").serialize(),t="muraAction=cComments.bulkEdit&siteid="+siteid+"&"+e+"&cacheid="+Math.random();$.get("./?"+t,function(){commentManager.submitSearch()})},singleEdit:function(e,t){var n="muraAction=cComments.singleEdit&siteid="+siteid+"&commentid="+e+"&updateaction="+t+"&cacheid="+Math.random();commentManager.reload=!0,$.get("./?"+n,function(){$(".modal").modal("hide")})},submitSearch:function(){commentManager.loadSearch($("#commentSearch input, #commentSearch select").serialize())},setSort:function(e){$("#sortBy").val(e.attr("data-sortby")),$("#sortDirection").val(e.attr("data-sortdirection")),commentManager.submitSearch()},setNextN:function(e){$("#nextN").val(e.attr("data-nextn")),commentManager.submitSearch()},setPageNo:function(e){$("#pageNo").val(e.attr("data-pageno")),commentManager.submitSearch()},bindEvents:function(){$("#btnSearch").click(function(e){e.preventDefault(),commentManager.submitSearch()}),$("#frmSearch").submit(function(e){e.preventDefault(),commentManager.submitSearch()}),$("a.sort").click(function(e){e.preventDefault(),commentManager.setSort($(this))}),$("a.nextN").click(function(e){e.preventDefault(),commentManager.setNextN($(this))}),$("a.pageNo").click(function(e){e.preventDefault(),commentManager.setPageNo($(this))}),$("#checkall").click(function(e){e.preventDefault();var t=$(":checkbox.checkall");t.prop("checked",!t.prop("checked"))}),$("a.bulkEdit").click(function(e){e.preventDefault();var t=$(this);confirmDialog(t.attr("data-alertmessage"),function(){$("#bulkedit").val(t.attr("data-action")),commentManager.bulkEdit()})}),$("a#purge-comments").click(function(e){e.preventDefault();var t=$(this);console.log("request to purge"),confirmDialog(t.attr("data-alertmessage"),function(){console.log("purge approved"),actionModal(function(){commentManager.purgeDeletedComments()})})}),$("a.singleEdit").click(function(e){e.preventDefault();var t=$(this);commentManager.singleEdit(t.attr("data-commentid"),t.attr("data-action"))}),$(".modal").on("show.bs.modal",function(){var e=$(this),t={contentID:e.attr("data-contentid"),commentID:e.attr("data-commentid")};e.find("div.modal-body").html('<div class="load-inline"></div>'),e.find("div.modal-body .load-inline").spin(spinnerArgs2),commentManager.loadPage(t).success(function(t){e.find("div.modal-body").html(t);var n=$("#detail-"+e.attr("data-commentid"));n.fadeIn(),e.find("div.modal-body").animate({scrollTop:n.position().top},"slow"),commentManager.bindAjaxEvents(e)})}),$(".modal").on("hidden.bs.modal",function(){if(commentManager.reload)commentManager.submitSearch();else{var e=$(this);e.find("#commentsPage").remove(),e.find("div.modal-body").html('<div class="load-inline"></div>'),e.find("div.modal-body .load-inline").spin(spinnerArgs2)}})},bindAjaxEvents:function(e){e.find("#moreCommentsUp").unbind("click").on("click",function(t){t.preventDefault();var n={contentID:e.attr("data-contentid"),upperID:$(this).attr("data-upperid")};commentManager.loadPage(n).success(function(t){e.find("#moreCommentsUpContainer").remove(),$(t).prependTo(e.find("#commentsPage")).hide().fadeIn(),commentManager.bindAjaxEvents(e)})}),e.find("#moreCommentsDown").unbind("click").on("click",function(t){t.preventDefault();var n={contentID:e.attr("data-contentid"),lowerID:$(this).attr("data-lowerid")};commentManager.loadPage(n).success(function(t){e.find("#moreCommentsDownContainer").remove(),$(t).appendTo(e.find("#commentsPage")).hide().fadeIn(),commentManager.bindAjaxEvents(e)})}),e.find(".inReplyTo").on("click",function(t){t.preventDefault();var n=$(this).attr("data-parentid");if($("#detail-"+n).length)commentManager.scrollToID($("#detail-"+n));else{var a={contentID:e.attr("data-contentid"),upperID:$(this).attr("data-parentid")};commentManager.loadPage(a).success(function(t){e.find("#moreCommentsUpContainer").remove(),$(t).prependTo(e.find("#commentsPage")).hide().fadeIn(),commentManager.bindAjaxEvents(e),commentManager.scrollToID($("#detail-"+n))})}})},scrollToID:function(e){$("html, body").animate({scrollTop:e.offset().top-50},500,function(){e.fadeTo("fast",.5,function(){e.fadeTo("fast",1)})})},loadPage:function(e){var t={muraAction:"ccomments.loadcommentspage",sortDirection:"asc",siteid:siteid};return $.extend(t,e),$.ajax({url:"./",data:t,cache:!1})},purgeDeletedComments:function(){var e="muraAction=cComments.purgeDeletedComments&siteid="+siteid+"&cacheid="+Math.random();$.get("./?"+e,function(){$("#action-modal").remove(),commentManager.submitSearch()})}};